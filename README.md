# Тестовое задание

## Задание 1
Заказчик утверждает, что продажи с НДС по сети, по группе товаров 'Биологически активныедобавки', в июне 2017 составил 1 782 949.1 руб. Продажи шт. - 6761.10.
Необходимо найти и устранить возможные причины расхождений.

- Объём продаж: `6761.10` штук  
- Сумма продаж с НДС: `1 782 949.10` рублей

Задача: найти причину расхождения с результатом ETL-процедуры.

---

## Вывод

Были выявлены следующие проблемы:

- В `dim_goods` найдены дубликаты по `good_id`: `245427`, `102018`, `1553`
- В `dim_cash_register` дубликат по `cash_register_id = 7`
- В `dim_stores` отсутствует `store_id = 47`, хотя в фактах (`fct_cheque`) он используется
- Некоторые строки в фактах ссылаются на объекты, которых нет в справочниках
- Важно использовать `sale_grs`, а не `sale_net`, если речь про сумму **с НДС**

Эти несоответствия могли искажать результаты, если запросы строились на `JOIN`-ах. В решении использован фильтр через `IN`, а не `JOIN`, чтобы минимизировать влияние этих проблем.
---

## Финальный запрос

```sql
SELECT 
    SUM(sale_grs) AS [Продажи руб., с НДС],
    SUM(quantity) AS [Объём продаж, шт.]
FROM fct_cheque 
WHERE date_id BETWEEN 20170601 AND 20170630 
  AND good_id IN (
    SELECT good_id 
    FROM dim_goods 
    WHERE group_name = 'Биологически активные добавки'
);
```

Этот запрос вернул:
- `6761.10` штук
- `1 782 949.10` руб. с НДС

---
